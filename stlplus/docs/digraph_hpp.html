<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>digraph.hpp</title>
<meta http-equiv="generator" content="ccolour C++ colouriser by Andy Rushton">
</head>
<body lang="en">
<h1>digraph.hpp</h1>
<pre style="background-color: #ffffff">

<span style="color: #990000">#ifndef</span> <span style="color: #000000">DIGRAPH_HPP</span>
<span style="color: #990000">#define</span> <span style="color: #000000">DIGRAPH_HPP</span>
<span style="color: #000099">/*----------------------------------------------------------------------------</span>
<span style="color: #000099"></span>
<span style="color: #000099">  Author:    Andy Rushton</span>
<span style="color: #000099">  Copyright: (c) Andy Rushton, 2004</span>
<span style="color: #000099">  License:   BSD License, see ../docs/license.html</span>
<span style="color: #000099">     </span>
<span style="color: #000099">  STL-style Directed graph template component</span>
<span style="color: #000099">  Digraph stands for directed-graph, i.e. all arcs have a direction</span>
<span style="color: #000099"></span>
<span style="color: #000099">------------------------------------------------------------------------------*/</span>
<span style="color: #990000">#include</span> <span style="color: #009900">"os_fixes.hpp"</span>
<span style="color: #990000">#include</span> <span style="color: #009900">"textio.hpp"</span>
<span style="color: #990000">#include</span> <span style="color: #009900">"persistent.hpp"</span>
<span style="color: #990000">#include</span> <span style="color: #009900">"exceptions.hpp"</span>
<span style="color: #990000">#include</span> <span style="color: #009900">&lt;vector&gt;</span>
<span style="color: #990000">#include</span> <span style="color: #009900">&lt;map&gt;</span>
<span style="color: #990000">#include</span> <span style="color: #009900">&lt;set&gt;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #000099">// Internals</span>

<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">&gt;</span> <span style="color: #990000">class</span> <span style="color: #000000">digraph_node</span><span style="color: #330033">;</span>
<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">&gt;</span> <span style="color: #990000">class</span> <span style="color: #000000">digraph_arc</span><span style="color: #330033">;</span>
<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">&gt;</span> <span style="color: #990000">class</span> <span style="color: #000000">digraph</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #000099">// The Digraph iterator classes</span>
<span style="color: #000099">// a digraph_iterator points to a node whilst a digraph_arc_iterator points to an arc</span>
<span style="color: #000099">// Note that these are redefined as:</span>
<span style="color: #000099">//   digraph&lt;NT,AT&gt;::iterator           - points to a non-const node</span>
<span style="color: #000099">//   digraph&lt;NT,AT&gt;::const_iterator     - points to a const node</span>
<span style="color: #000099">//   digraph&lt;NT,AT&gt;::arc_iterator       - points to a non-const arc</span>
<span style="color: #000099">//   digraph&lt;NT,AT&gt;::const_arc_iterator - points to a const arc</span>
<span style="color: #000099">// and this is the form in which they should be used</span>

<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">NRef</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">NPtr</span><span style="color: #330033">&gt;</span>
<span style="color: #990000">class</span> <span style="color: #000000">digraph_iterator</span>
<span style="color: #330033">{</span>
<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">;</span>

  <span style="color: #000099">// local type definitions</span>
  <span style="color: #000099">// an iterator points to an object whilst a const_iterator points to a const object</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">digraph_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">NT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span><span style="color: #000000">NT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">iterator</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">digraph_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #990000">const</span> <span style="color: #000000">NT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span><span style="color: #990000">const</span> <span style="color: #000000">NT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">const_iterator</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">digraph_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">NRef</span><span style="color: #330033">,</span><span style="color: #000000">NPtr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">this_iterator</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">NRef</span> <span style="color: #000000">reference</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">NPtr</span> <span style="color: #000000">pointer</span><span style="color: #330033">;</span>

  <span style="color: #000099">// constructor to create a null iterator - you must assign a valid value to this iterator before using it</span>
  <span style="color: #000000">digraph_iterator</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #330033">~</span><span style="color: #000000">digraph_iterator</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// tests</span>
  <span style="color: #000099">// a null iterator is one that has not been initialised with a value yet</span>
  <span style="color: #000099">// i.e. you just declared it but didn't assign to it</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">null</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000099">// an end iterator is one that points to the end element of the list of nodes</span>
  <span style="color: #000099">// in STL conventions this is one past the last valid element and must not be dereferenced</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">end</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000099">// a valid iterator is one that can be dereferenced</span>
  <span style="color: #000099">// i.e. non-null and non-end</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">valid</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// get the digraph object that created this iterator</span>
  <span style="color: #000099">// a null iterator doesn't have an owner so returns a null pointer</span>
  <span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">owner</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// Type conversion methods allow const_iterator and iterator to be converted</span>
  <span style="color: #000099">// convert an iterator/const_iterator to a const_iterator</span>
  <span style="color: #000000">const_iterator</span> <span style="color: #000000">constify</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000099">// convert an iterator/const_iterator to an iterator</span>
  <span style="color: #000000">iterator</span> <span style="color: #000000">deconstify</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// increment/decrement operators used to step through the set of all nodes in a graph</span>
  <span style="color: #000099">// it is only legal to increment a valid iterator</span>
  <span style="color: #000099">// pre-increment</span>
  <span style="color: #000000">this_iterator</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">+</span><span style="color: #330033">+</span> <span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// post-increment</span>
  <span style="color: #000000">this_iterator</span> <span style="color: #990000">operator</span> <span style="color: #330033">+</span><span style="color: #330033">+</span> <span style="color: #330033">(</span><span style="color: #990000">int</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// pre-decrement</span>
  <span style="color: #000000">this_iterator</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">-</span><span style="color: #330033">-</span> <span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// post-decrement</span>
  <span style="color: #000000">this_iterator</span> <span style="color: #990000">operator</span> <span style="color: #330033">-</span><span style="color: #330033">-</span> <span style="color: #330033">(</span><span style="color: #990000">int</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// tests useful for putting iterators into other STL structures and for testing whether iteration has completed</span>
  <span style="color: #990000">bool</span> <span style="color: #990000">operator</span> <span style="color: #330033">=</span><span style="color: #330033">=</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">this_iterator</span><span style="color: #330033">&amp;</span> <span style="color: #000000">r</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #990000">operator</span> <span style="color: #330033">!</span><span style="color: #330033">=</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">this_iterator</span><span style="color: #330033">&amp;</span> <span style="color: #000000">r</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">this_iterator</span><span style="color: #330033">&amp;</span> <span style="color: #000000">r</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// access the node data - a const_iterator gives you a const element, an iterator a non-const element</span>
  <span style="color: #000099">// it is illegal to dereference an invalid (i.e. null or end) iterator</span>
  <span style="color: #000000">reference</span> <span style="color: #990000">operator</span><span style="color: #330033">*</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">pointer</span> <span style="color: #990000">operator</span><span style="color: #330033">-&gt;</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// data persistence</span>
  <span style="color: #000099">// Note: the owning graph must be dumped/restored first</span>
  <span style="color: #990000">void</span> <span style="color: #000000">dump</span><span style="color: #330033">(</span><span style="color: #000000">dump_context</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_dump_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">restore</span><span style="color: #330033">(</span><span style="color: #000000">restore_context</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_restore_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #990000">private</span><span style="color: #330033">:</span>
  <span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">m_owner</span><span style="color: #330033">;</span>
  <span style="color: #000000">digraph_node</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">m_node</span><span style="color: #330033">;</span>

<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #000099">// Note: I had to make these public to get round a compiler problem - it should be private</span>

  <span style="color: #000099">// internal error checking routines</span>
  <span style="color: #990000">void</span> <span style="color: #000000">check_owner</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">owner</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">check_non_null</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">check_non_end</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">check_valid</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">check</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">owner</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// constructor used by digraph to create a non-null iterator</span>
  <span style="color: #000099">// you cannot create a valid iterator except by calling a digraph method that returns one</span>
  <span style="color: #990000">explicit</span> <span style="color: #000000">digraph_iterator</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">owner</span><span style="color: #330033">,</span> <span style="color: #000000">digraph_node</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">node</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #330033">}</span><span style="color: #330033">;</span>

<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">NRef</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">NPtr</span><span style="color: #330033">&gt;</span>
<span style="color: #990000">void</span> <span style="color: #000000">dump_digraph_iterator</span><span style="color: #330033">(</span><span style="color: #000000">dump_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">digraph_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">NRef</span><span style="color: #330033">,</span><span style="color: #000000">NPtr</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span> <span style="color: #000000">data</span><span style="color: #330033">)</span>
  <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_dump_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">NRef</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">NPtr</span><span style="color: #330033">&gt;</span>
<span style="color: #990000">void</span> <span style="color: #000000">restore_digraph_iterator</span><span style="color: #330033">(</span><span style="color: #000000">restore_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #000000">digraph_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">NRef</span><span style="color: #330033">,</span><span style="color: #000000">NPtr</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span> <span style="color: #000000">data</span><span style="color: #330033">)</span>
  <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_restore_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>

<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">ARef</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">APtr</span><span style="color: #330033">&gt;</span>
<span style="color: #990000">class</span> <span style="color: #000000">digraph_arc_iterator</span>
<span style="color: #330033">{</span>
<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">;</span>

  <span style="color: #000099">// local type definitions</span>
  <span style="color: #000099">// an iterator points to an object whilst a const_iterator points to a const object</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">iterator</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #990000">const</span> <span style="color: #000000">AT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span><span style="color: #990000">const</span> <span style="color: #000000">AT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">const_iterator</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">ARef</span><span style="color: #330033">,</span><span style="color: #000000">APtr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">this_iterator</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">ARef</span> <span style="color: #000000">reference</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">APtr</span> <span style="color: #000000">pointer</span><span style="color: #330033">;</span>

  <span style="color: #000099">// constructor to create a null iterator - you must assign a valid value to this iterator before using it</span>
  <span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #330033">~</span><span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// tests</span>
  <span style="color: #000099">// a null iterator is one that has not been initialised with a value yet</span>
  <span style="color: #000099">// i.e. you just declared it but didn't assign to it</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">null</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000099">// an end iterator is one that points to the end element of the list of nodes</span>
  <span style="color: #000099">// in STL conventions this is one past the last valid element and must not be dereferenced</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">end</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000099">// a valid iterator is one that can be dereferenced</span>
  <span style="color: #000099">// i.e. non-null and non-end</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">valid</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// get the digraph object that created this iterator</span>
  <span style="color: #000099">// a null iterator doesn't have an owner so returns a null pointer</span>
  <span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">owner</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// Type conversion methods allow const_iterator and iterator to be converted</span>
  <span style="color: #000099">// convert an iterator/const_iterator to a const_iterator</span>
  <span style="color: #000000">const_iterator</span> <span style="color: #000000">constify</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000099">// convert an iterator/const_iterator to an iterator</span>
  <span style="color: #000000">iterator</span> <span style="color: #000000">deconstify</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// increment/decrement operators used to step through the set of all nodes in a graph</span>
  <span style="color: #000099">// it is only legal to increment a valid iterator</span>
  <span style="color: #000099">// pre-increment</span>
  <span style="color: #000000">this_iterator</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">+</span><span style="color: #330033">+</span> <span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// post-increment</span>
  <span style="color: #000000">this_iterator</span> <span style="color: #990000">operator</span> <span style="color: #330033">+</span><span style="color: #330033">+</span> <span style="color: #330033">(</span><span style="color: #990000">int</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// pre-decrement</span>
  <span style="color: #000000">this_iterator</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">-</span><span style="color: #330033">-</span> <span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// post-decrement</span>
  <span style="color: #000000">this_iterator</span> <span style="color: #990000">operator</span> <span style="color: #330033">-</span><span style="color: #330033">-</span> <span style="color: #330033">(</span><span style="color: #990000">int</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// tests useful for putting iterators into other STL structures and for testing whether iteration has completed</span>
  <span style="color: #990000">bool</span> <span style="color: #990000">operator</span> <span style="color: #330033">=</span><span style="color: #330033">=</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">this_iterator</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #990000">operator</span> <span style="color: #330033">!</span><span style="color: #330033">=</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">this_iterator</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">this_iterator</span><span style="color: #330033">&amp;</span> <span style="color: #000000">r</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// access the node data - a const_iterator gives you a const element, an iterator a non-const element</span>
  <span style="color: #000099">// it is illegal to dereference an invalid (i.e. null or end) iterator</span>
  <span style="color: #000000">reference</span> <span style="color: #990000">operator</span><span style="color: #330033">*</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">pointer</span> <span style="color: #990000">operator</span><span style="color: #330033">-&gt;</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// data persistence</span>
  <span style="color: #000099">// Note: the owning graph must be dumped/restored first</span>
  <span style="color: #990000">void</span> <span style="color: #000000">dump</span><span style="color: #330033">(</span><span style="color: #000000">dump_context</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_dump_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">restore</span><span style="color: #330033">(</span><span style="color: #000000">restore_context</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_restore_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #990000">private</span><span style="color: #330033">:</span>
  <span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">m_owner</span><span style="color: #330033">;</span>
  <span style="color: #000000">digraph_arc</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">m_arc</span><span style="color: #330033">;</span>

<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #000099">// Note: I had to make these public to get round a compiler problem - it should be private</span>

  <span style="color: #000099">// internal error checking routines</span>
  <span style="color: #990000">void</span> <span style="color: #000000">check_owner</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">owner</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">check_non_null</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">check_non_end</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">check_valid</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">check</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">owner</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// constructor used by digraph to create a non-null iterator</span>
  <span style="color: #000099">// you cannot create a valid iterator except by calling a digraph method that returns one</span>
  <span style="color: #990000">explicit</span> <span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">owner</span><span style="color: #330033">,</span> <span style="color: #000000">digraph_arc</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">arc</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #330033">}</span><span style="color: #330033">;</span>

<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">NRef</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">NPtr</span><span style="color: #330033">&gt;</span>
<span style="color: #990000">void</span> <span style="color: #000000">dump_digraph_arc_iterator</span><span style="color: #330033">(</span><span style="color: #000000">dump_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">NRef</span><span style="color: #330033">,</span><span style="color: #000000">NPtr</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span> <span style="color: #000000">data</span><span style="color: #330033">)</span>
  <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_dump_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">NRef</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">NPtr</span><span style="color: #330033">&gt;</span>
<span style="color: #990000">void</span> <span style="color: #000000">restore_digraph_arc_iterator</span><span style="color: #330033">(</span><span style="color: #000000">restore_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">NRef</span><span style="color: #330033">,</span><span style="color: #000000">NPtr</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span> <span style="color: #000000">data</span><span style="color: #330033">)</span>
  <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_restore_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #000099">// The Graph class</span>
<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #000099">// NT is the Node type and AT is the Arc type</span>

<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">&gt;</span>
<span style="color: #990000">class</span> <span style="color: #000000">digraph</span>
<span style="color: #330033">{</span>
<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #000099">// STL-like typedefs for the types and iterators</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">NT</span> <span style="color: #000000">node_type</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">AT</span> <span style="color: #000000">arc_type</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">digraph_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">NT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span><span style="color: #000000">NT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">iterator</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">digraph_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #990000">const</span> <span style="color: #000000">NT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span><span style="color: #990000">const</span> <span style="color: #000000">NT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">const_iterator</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">arc_iterator</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #990000">const</span> <span style="color: #000000">AT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">AT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">const_arc_iterator</span><span style="color: #330033">;</span>

  <span style="color: #000099">// supplementary types used throughout</span>

  <span style="color: #000099">// a path is represented as a vector of arcs so the forward traversal is done by going from begin() to end() or 0 to size-1</span>
  <span style="color: #000099">// of course a backward traversal can be done by traversing the vector backwards</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">arc_iterator</span><span style="color: #330033">&gt;</span> <span style="color: #000000">arc_vector</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">const_arc_iterator</span><span style="color: #330033">&gt;</span> <span style="color: #000000">const_arc_vector</span><span style="color: #330033">;</span>
  <span style="color: #000000">const_arc_vector</span> <span style="color: #000000">constify_arcs</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">arc_vector</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_vector</span> <span style="color: #000000">deconstify_arcs</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">const_arc_vector</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// a path list is a vector of paths used to represent all the paths from one node to another</span>
  <span style="color: #000099">// there is no particular ordering to the paths in the vector</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">arc_vector</span><span style="color: #330033">&gt;</span> <span style="color: #000000">path_vector</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">const_arc_vector</span><span style="color: #330033">&gt;</span> <span style="color: #000000">const_path_vector</span><span style="color: #330033">;</span>
  <span style="color: #000000">const_path_vector</span> <span style="color: #000000">constify_paths</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">path_vector</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">path_vector</span> <span style="color: #000000">deconstify_paths</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">const_path_vector</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// a node vector is a simple vector of nodes used to represent the reachable sets</span>
  <span style="color: #000099">// there is no particular ordering to the nodes in the vector</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">iterator</span><span style="color: #330033">&gt;</span> <span style="color: #000000">node_vector</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">const_iterator</span><span style="color: #330033">&gt;</span> <span style="color: #000000">const_node_vector</span><span style="color: #330033">;</span>
  <span style="color: #000000">const_node_vector</span> <span style="color: #000000">constify_nodes</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">node_vector</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">node_vector</span> <span style="color: #000000">deconstify_nodes</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">const_node_vector</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// callback used in the path algorithms to select which arcs to consider</span>
  <span style="color: #990000">typedef</span> <span style="color: #990000">bool</span> <span style="color: #330033">(</span><span style="color: #330033">*</span><span style="color: #000000">arc_select_fn</span><span style="color: #330033">)</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #000000">const_arc_iterator</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// a value representing an unknown offset</span>
  <span style="color: #000099">// Note that it's static so use in the form digraph&lt;NT,AT&gt;::npos()</span>
  <span style="color: #990000">static</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">npos</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// Constructors, destructors and copies</span>

  <span style="color: #000000">digraph</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #330033">~</span><span style="color: #000000">digraph</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// copy constructor and assignment both copy the graph</span>
  <span style="color: #000000">digraph</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span><span style="color: #330033">=</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// Basic Node functions</span>
  <span style="color: #000099">// Nodes are referred to by iterators created when the node is inserted.</span>
  <span style="color: #000099">// Iterators remain valid unless the node is erased (they are list iterators, so no resize problems)</span>
  <span style="color: #000099">// It is also possible to walk through all the nodes using a list-like start() to end() loop</span>
  <span style="color: #000099">// Each node has a set of input arcs and output arcs. These are indexed by an unsigned i.e. they form a vector.</span>
  <span style="color: #000099">// The total number of inputs is the fanin and the total number of outputs is the fanout.</span>
  <span style="color: #000099">// The contents of the node (type NT) are accessed, of course, by dereferencing the node iterator.</span>

  <span style="color: #000099">// tests for the number of nodes and the special test for zero nodes</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">empty</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">size</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// add a new node and return its iterator</span>
  <span style="color: #000000">iterator</span> <span style="color: #000000">insert</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">NT</span><span style="color: #330033">&amp;</span> <span style="color: #000000">node_data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// remove a node and return the iterator to the next node</span>
  <span style="color: #000099">// erasing a node erases its arcs</span>
  <span style="color: #000000">iterator</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// remove all nodes</span>
  <span style="color: #990000">void</span> <span style="color: #000000">clear</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// traverse all the nodes using STL-style iteration</span>
  <span style="color: #000000">const_iterator</span> <span style="color: #000000">begin</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">iterator</span> <span style="color: #000000">begin</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">const_iterator</span> <span style="color: #000000">end</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">iterator</span> <span style="color: #000000">end</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// access the inputs of this node</span>
  <span style="color: #000099">// the fanin is the number of inputs and the inputs are accessed using an index from 0..fanin-1</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">fanin</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">fanin</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">const_arc_iterator</span> <span style="color: #000000">input</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_iterator</span> <span style="color: #000000">input</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// access the outputs of this node</span>
  <span style="color: #000099">// the fanout is the number of outputs and the outputs are accessed using an index from 0..fanout-1</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">fanout</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">fanout</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">const_arc_iterator</span> <span style="color: #000000">output</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_iterator</span> <span style="color: #000000">output</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000000">const_arc_vector</span> <span style="color: #000000">inputs</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_vector</span> <span style="color: #000000">inputs</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">const_arc_vector</span> <span style="color: #000000">outputs</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_vector</span> <span style="color: #000000">outputs</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// find the output index of an arc which goes from this node</span>
  <span style="color: #000099">// returns digraph&lt;NT,AT&gt;::npos if the arc is not an output of from</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">output_offset</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">const_arc_iterator</span> <span style="color: #000000">arc</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">output_offset</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">arc_iterator</span> <span style="color: #000000">arc</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// ditto for an input arc</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">input_offset</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">const_arc_iterator</span> <span style="color: #000000">arc</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">input_offset</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">arc_iterator</span> <span style="color: #000000">arc</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// Basic Arc functions</span>
  <span style="color: #000099">// to avoid name conflicts, arc functions have the arc_ prefix </span>
  <span style="color: #000099">// Arcs, like nodes, are referred to by a list iterator which is returned by the arc_insert function</span>
  <span style="color: #000099">// They may also be visited from arc_begin() to arc_end()</span>
  <span style="color: #000099">// Each arc has a from field and a to field which contain the node iterators of the endpoints of the arc</span>
  <span style="color: #000099">// Of course, the arc data can be accessed by simply dereferencing the iterator</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">arc_empty</span> <span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">arc_size</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_iterator</span> <span style="color: #000000">arc_insert</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">AT</span><span style="color: #330033">&amp;</span> <span style="color: #000000">arc_data</span> <span style="color: #330033">=</span> <span style="color: #000000">AT</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_iterator</span> <span style="color: #000000">arc_erase</span><span style="color: #330033">(</span><span style="color: #000000">arc_iterator</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">arc_clear</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000000">const_arc_iterator</span> <span style="color: #000000">arc_begin</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_iterator</span> <span style="color: #000000">arc_begin</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">const_arc_iterator</span> <span style="color: #000000">arc_end</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_iterator</span> <span style="color: #000000">arc_end</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000000">const_iterator</span> <span style="color: #000000">arc_from</span><span style="color: #330033">(</span><span style="color: #000000">const_arc_iterator</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">iterator</span> <span style="color: #000000">arc_from</span><span style="color: #330033">(</span><span style="color: #000000">arc_iterator</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">const_iterator</span> <span style="color: #000000">arc_to</span><span style="color: #330033">(</span><span style="color: #000000">const_arc_iterator</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">iterator</span> <span style="color: #000000">arc_to</span><span style="color: #330033">(</span><span style="color: #000000">arc_iterator</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">void</span> <span style="color: #000000">arc_move</span><span style="color: #330033">(</span><span style="color: #000000">arc_iterator</span> <span style="color: #000000">arc</span><span style="color: #330033">,</span> <span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">arc_move_from</span><span style="color: #330033">(</span><span style="color: #000000">arc_iterator</span> <span style="color: #000000">arc</span><span style="color: #330033">,</span> <span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">arc_move_to</span><span style="color: #330033">(</span><span style="color: #000000">arc_iterator</span> <span style="color: #000000">arc</span><span style="color: #330033">,</span> <span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">arc_flip</span><span style="color: #330033">(</span><span style="color: #000000">arc_iterator</span> <span style="color: #000000">arc</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// Adjacency algorithms</span>

  <span style="color: #000099">// test whether the nodes are adjacent i.e. whether there is an arc going from from to to</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">adjacent</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">adjacent</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// as above, but returns the arc that makes the nodes adjacent</span>
  <span style="color: #000099">// returns the first arc if there's more than one, returns arc_end() if there are none</span>
  <span style="color: #000000">const_arc_iterator</span> <span style="color: #000000">adjacent_arc</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_iterator</span> <span style="color: #000000">adjacent_arc</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// as above, but returns the set of all arcs that make two nodes adjacent (there may be more than one)</span>
  <span style="color: #000099">// returns an empty vector if there are none</span>
  <span style="color: #000000">const_arc_vector</span> <span style="color: #000000">adjacent_arcs</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_vector</span> <span style="color: #000000">adjacent_arcs</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// return the adjacency sets for the node inputs or outputs, i.e. the set of nodes adjacent to this node</span>
  <span style="color: #000099">// each adjacent node will only be entered once even if there are multiple arcs between the nodes</span>
  <span style="color: #000000">const_node_vector</span> <span style="color: #000000">input_adjacencies</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">node_vector</span> <span style="color: #000000">input_adjacencies</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">const_node_vector</span> <span style="color: #000000">output_adjacencies</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">node_vector</span> <span style="color: #000000">output_adjacencies</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// Topographical Sort Algorithm</span>
  <span style="color: #000099">// This generates a node ordering such that each node is visited after its fanin nodes.</span>

  <span style="color: #000099">// This only generates a valid ordering for a DAG. </span>

  <span style="color: #000099">// The return value is a pair : </span>
  <span style="color: #000099">//  - the node vector which is a set of iterators to the nodes in sorted order</span>
  <span style="color: #000099">//  - the arc vector is the set of backward ards that were broken to achieve the sort</span>
  <span style="color: #000099">// If the arc vector is empty then the graph formed a DAG.</span>

  <span style="color: #000099">// The arc selection callback can be used to ignore arcs that are not part</span>
  <span style="color: #000099">// of the ordering, i.e. arcs that are meant to be backwards arcs</span>

  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">pair</span><span style="color: #330033">&lt;</span><span style="color: #000000">const_node_vector</span><span style="color: #330033">,</span><span style="color: #000000">const_arc_vector</span><span style="color: #330033">&gt;</span> <span style="color: #000000">sort</span><span style="color: #330033">(</span><span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">pair</span><span style="color: #330033">&lt;</span><span style="color: #000000">node_vector</span><span style="color: #330033">,</span><span style="color: #000000">arc_vector</span><span style="color: #330033">&gt;</span> <span style="color: #000000">sort</span><span style="color: #330033">(</span><span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// Simplified variant of above for graphs that are known to be DAGs.</span>
  <span style="color: #000099">// If the sort fails due to backward arcs, the</span>
  <span style="color: #000099">// return vector is empty. Note that this will also be empty if the graph</span>
  <span style="color: #000099">// has no nodes in it, so use the empty() method to differentiate.</span>

  <span style="color: #000000">const_node_vector</span> <span style="color: #000000">dag_sort</span><span style="color: #330033">(</span><span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">node_vector</span> <span style="color: #000000">dag_sort</span><span style="color: #330033">(</span><span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// Basic Path Algorithms</span>
  <span style="color: #000099">// A path is a series of arcs - you can use arc_from and arc_to to convert</span>
  <span style="color: #000099">// that into a series of nodes. All the path algorithms take an arc_select</span>
  <span style="color: #000099">// which allows arcs to be selected or rejected for consideration in a path.</span>

  <span style="color: #000099">// A selection callback function is applied to each arc in the traversal and</span>
  <span style="color: #000099">// returns true if the arc is to be selected and false if the arc is to be</span>
  <span style="color: #000099">// rejected. If no function is provided the arc is selected. If you want to</span>
  <span style="color: #000099">// use arc selection you should create a function with the type profile given</span>
  <span style="color: #000099">// by the arc_select_fn type. The select function is passed both the graph and</span>
  <span style="color: #000099">// the arc iterator so that it is possible to select an arc on the basis of</span>
  <span style="color: #000099">// the nodes it is connected to.</span>

  <span style="color: #000099">// Note: I used a callback because the STL-like predicate idea wasn't working for me...</span>

  <span style="color: #000099">// test for the existence of a path from from to to</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">path_exists</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">path_exists</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// get the set of all paths from from to to</span>
  <span style="color: #000000">const_path_vector</span> <span style="color: #000000">all_paths</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">path_vector</span> <span style="color: #000000">all_paths</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// get the set of all nodes that can be reached by any path from from</span>
  <span style="color: #000000">const_node_vector</span> <span style="color: #000000">reachable_nodes</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">node_vector</span> <span style="color: #000000">reachable_nodes</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// get the set of all nodes that can reach to to by any path</span>
  <span style="color: #000000">const_node_vector</span> <span style="color: #000000">reaching_nodes</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">node_vector</span> <span style="color: #000000">reaching_nodes</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// Unweighted Shortest path algorithms</span>

  <span style="color: #000099">// find the shortest path from from to to</span>
  <span style="color: #000099">// This is an unweighted shortest path algorithm, i.e. the weight of each arc is assumed to be 1, so just counts the number of arcs</span>
  <span style="color: #000099">// if there is more than one shortest path it returns the first one</span>
  <span style="color: #000099">// If there are no paths, returns an empty path</span>
  <span style="color: #000000">const_arc_vector</span> <span style="color: #000000">shortest_path</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">arc_vector</span> <span style="color: #000000">shortest_path</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// find the set of shortest paths from from to any other node in the graph that is reachable (i.e. for which path_exists() is true)</span>
  <span style="color: #000099">// This is an unweighted shortest path, so just counts the number of arcs</span>
  <span style="color: #000099">// if there is more than one shortest path to a node it returns the first one</span>
  <span style="color: #000099">// If there are no paths, returns an empty list</span>
  <span style="color: #000000">const_path_vector</span> <span style="color: #000000">shortest_paths</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">path_vector</span> <span style="color: #000000">shortest_paths</span><span style="color: #330033">(</span><span style="color: #000000">iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// Print function for the digraph produces a report giving the set of nodes</span>
  <span style="color: #000099">// and their input/output arcs and the set of arcs with their to/from nodes.</span>
  <span style="color: #000099">// The other print routines allow printing of other structures representing</span>
  <span style="color: #000099">// paths etc.</span>

  <span style="color: #000099">// The builtin print functions give a basic format using the addresses of the</span>
  <span style="color: #000099">// node data and arc data fields to represent the nodes and arcs.</span>

  <span style="color: #000099">// a node or arc is printed in diagnostic routines as just its address</span>
  <span style="color: #000099">// these functions are used in all the subsequent print routines for consistency</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_node</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">const_iterator</span><span style="color: #330033">&amp;</span> <span style="color: #000000">i</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_node</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">iterator</span><span style="color: #330033">&amp;</span> <span style="color: #000000">i</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_arc</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">const_arc_iterator</span><span style="color: #330033">&amp;</span> <span style="color: #000000">i</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_arc</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">arc_iterator</span><span style="color: #330033">&amp;</span> <span style="color: #000000">i</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// a path will be printed in the form {arc1,arc2,arc3}</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_arc_vector</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">const_arc_vector</span><span style="color: #330033">&amp;</span> <span style="color: #000000">p</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_arc_vector</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">arc_vector</span><span style="color: #330033">&amp;</span> <span style="color: #000000">p</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// a path list is a comma-separated list of paths: {arc1,arc2,arc3},{arc4}</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_path_vector</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">const_path_vector</span><span style="color: #330033">&amp;</span> <span style="color: #000000">paths</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_path_vector</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">path_vector</span><span style="color: #330033">&amp;</span> <span style="color: #000000">paths</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// a node vector will be printed in the form {node1,node2,node3}</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_node_vector</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">const_node_vector</span><span style="color: #330033">&amp;</span> <span style="color: #000000">nodes</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_node_vector</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">node_vector</span><span style="color: #330033">&amp;</span> <span style="color: #000000">nodes</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// a multi-line printout listing first the nodes and their input and output arcs</span>
  <span style="color: #000099">// then a listing of the arcs and their to/from nodes.</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// persistence routines</span>
  <span style="color: #990000">void</span> <span style="color: #000000">dump</span><span style="color: #330033">(</span><span style="color: #000000">dump_context</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_dump_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">restore</span><span style="color: #330033">(</span><span style="color: #000000">restore_context</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_restore_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #990000">private</span><span style="color: #330033">:</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">digraph_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">NT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span><span style="color: #000000">NT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">digraph_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #990000">const</span> <span style="color: #000000">NT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span><span style="color: #990000">const</span> <span style="color: #000000">NT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">digraph_arc_iterator</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">,</span><span style="color: #990000">const</span> <span style="color: #000000">AT</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">AT</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span><span style="color: #330033">;</span>

  <span style="color: #990000">typedef</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">set</span><span style="color: #330033">&lt;</span><span style="color: #000000">const_iterator</span><span style="color: #330033">&gt;</span> <span style="color: #000000">const_iterator_set</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #990000">typename</span> <span style="color: #000000">const_iterator_set</span><span style="color: #330033">::</span><span style="color: #000000">iterator</span> <span style="color: #000000">const_iterator_set_iterator</span><span style="color: #330033">;</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">path_exists_r</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">const_iterator_set</span><span style="color: #330033">&amp;</span> <span style="color: #000000">visited</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">void</span> <span style="color: #000000">all_paths_r</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">const_arc_vector</span><span style="color: #330033">&amp;</span> <span style="color: #000000">so_far</span><span style="color: #330033">,</span> <span style="color: #000000">const_path_vector</span><span style="color: #330033">&amp;</span> <span style="color: #000000">result</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">void</span> <span style="color: #000000">reachable_nodes_r</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">from</span><span style="color: #330033">,</span> <span style="color: #000000">const_iterator_set</span><span style="color: #330033">&amp;</span> <span style="color: #000000">visited</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">void</span> <span style="color: #000000">reaching_nodes_r</span><span style="color: #330033">(</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">to</span><span style="color: #330033">,</span> <span style="color: #000000">const_iterator_set</span><span style="color: #330033">&amp;</span> <span style="color: #000000">visited</span><span style="color: #330033">,</span> <span style="color: #000000">arc_select_fn</span><span style="color: #330033">)</span> <span style="color: #990000">const</span>
    <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">wrong_object</span><span style="color: #330033">,</span><span style="color: #000000">null_dereference</span><span style="color: #330033">,</span><span style="color: #000000">end_dereference</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000000">digraph_node</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">m_nodes</span><span style="color: #330033">;</span>
  <span style="color: #000000">digraph_arc</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">*</span> <span style="color: #000000">m_arcs</span><span style="color: #330033">;</span>
<span style="color: #330033">}</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>

<span style="color: #000099">// Non-member version of digraph::print</span>
<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">&gt;</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_graph</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span> <span style="color: #000000">graph</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #000099">// non-member versions of the persistence functions</span>

<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">&gt;</span>
<span style="color: #990000">void</span> <span style="color: #000000">dump_digraph</span><span style="color: #330033">(</span><span style="color: #000000">dump_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span> <span style="color: #000000">data</span><span style="color: #330033">)</span>
  <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_dump_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #990000">template</span><span style="color: #330033">&lt;</span><span style="color: #990000">typename</span> <span style="color: #000000">NT</span><span style="color: #330033">,</span> <span style="color: #990000">typename</span> <span style="color: #000000">AT</span><span style="color: #330033">&gt;</span>
<span style="color: #990000">void</span> <span style="color: #000000">restore_digraph</span><span style="color: #330033">(</span><span style="color: #000000">restore_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #000000">digraph</span><span style="color: #330033">&lt;</span><span style="color: #000000">NT</span><span style="color: #330033">,</span><span style="color: #000000">AT</span><span style="color: #330033">&gt;</span><span style="color: #330033">&amp;</span> <span style="color: #000000">data</span><span style="color: #330033">)</span>
  <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_restore_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>

<span style="color: #990000">#include</span> <span style="color: #009900">"digraph.tpp"</span>
<span style="color: #990000">#endif</span>
</pre>
</body>
</html>
