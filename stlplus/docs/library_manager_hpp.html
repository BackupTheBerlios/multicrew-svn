<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>library_manager.hpp</title>
<meta http-equiv="generator" content="ccolour C++ colouriser by Andy Rushton">
</head>
<body lang="en">
<h1>library_manager.hpp</h1>
<pre style="background-color: #ffffff">

<span style="color: #990000">#ifndef</span> <span style="color: #000000">LIBRARY_MANAGER_HPP</span>
<span style="color: #990000">#define</span> <span style="color: #000000">LIBRARY_MANAGER_HPP</span>
<span style="color: #000099">/*------------------------------------------------------------------------------</span>
<span style="color: #000099"></span>
<span style="color: #000099">  Author:    Andy Rushton</span>
<span style="color: #000099">  Copyright: (c) Andy Rushton, 2004</span>
<span style="color: #000099">  License:   BSD License, see ../docs/license.html</span>
<span style="color: #000099"></span>
<span style="color: #000099">  Generalised library manager.</span>
<span style="color: #000099"></span>
<span style="color: #000099">  Manages library units in a set of library directories. A unit is both a file</span>
<span style="color: #000099">  on-disk and a data-structure in memory. To use the library manager, you need</span>
<span style="color: #000099">  to:</span>
<span style="color: #000099"></span>
<span style="color: #000099">  - design a type based on lm_unit with serialising functions read/write </span>
<span style="color: #000099">  - decide on a file extension for the type</span>
<span style="color: #000099">  - decide on a description of the type</span>
<span style="color: #000099">  - write a create callback for this type</span>
<span style="color: #000099">  - register the file extension, description and callback with the library manager</span>
<span style="color: #000099"></span>
<span style="color: #000099">  ------------------------------------------------------------------------------*/</span>
<span style="color: #990000">#include</span> <span style="color: #009900">"os_fixes.hpp"</span>
<span style="color: #990000">#include</span> <span style="color: #009900">"smart_ptr.hpp"</span>
<span style="color: #990000">#include</span> <span style="color: #009900">"textio.hpp"</span>
<span style="color: #990000">#include</span> <span style="color: #009900">"persistent.hpp"</span>
<span style="color: #990000">#include</span> <span style="color: #009900">"ini_manager.hpp"</span>
<span style="color: #990000">#include</span> <span style="color: #009900">&lt;string&gt;</span>
<span style="color: #990000">#include</span> <span style="color: #009900">&lt;vector&gt;</span>
<span style="color: #990000">#include</span> <span style="color: #009900">&lt;list&gt;</span>
<span style="color: #990000">#include</span> <span style="color: #009900">&lt;map&gt;</span>
<span style="color: #990000">#include</span> <span style="color: #009900">&lt;time.h&gt;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #000099">// unit names</span>
<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>

<span style="color: #990000">class</span> <span style="color: #000000">lm_unit_name</span>
<span style="color: #330033">{</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_name</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_type</span><span style="color: #330033">;</span>

<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #000000">lm_unit_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span> <span style="color: #330033">=</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span> <span style="color: #330033">=</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #330033">~</span><span style="color: #000000">lm_unit_name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">lowercase</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">friend</span> <span style="color: #990000">void</span> <span style="color: #000000">dump</span><span style="color: #330033">(</span><span style="color: #000000">dump_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_dump_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">void</span> <span style="color: #000000">restore</span><span style="color: #330033">(</span><span style="color: #000000">restore_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">,</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_restore_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">friend</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">to_string</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span> <span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">friend</span> <span style="color: #990000">bool</span> <span style="color: #990000">operator</span> <span style="color: #330033">=</span><span style="color: #330033">=</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">l</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">r</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">bool</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">l</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">r</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #330033">}</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #000099">// dependencies</span>
<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>

<span style="color: #000099">// dependencies on external files</span>

<span style="color: #990000">class</span> <span style="color: #000000">lm_file_dependency</span>
<span style="color: #330033">{</span>
<span style="color: #990000">private</span><span style="color: #330033">:</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_path</span><span style="color: #330033">;</span> <span style="color: #000099">// file dependencies are stored as paths relative to the containing library</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">m_line</span><span style="color: #330033">;</span>    <span style="color: #000099">// line - starts at 1, 0 means no line/column information</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">m_column</span><span style="color: #330033">;</span>  <span style="color: #000099">// column - starts at 0</span>
<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_path</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">line</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">column</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #330033">~</span><span style="color: #000000">lm_file_dependency</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// a path can be retrieved as either a relative path to the library or as a full path by providing the library path as an argument</span>
  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">path_full</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_path</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_path</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_path</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">unsigned</span> <span style="color: #000000">line</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_line</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span> <span style="color: #000000">line</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">unsigned</span> <span style="color: #000000">column</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_column</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span> <span style="color: #000000">column</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">friend</span> <span style="color: #990000">void</span> <span style="color: #000000">dump</span><span style="color: #330033">(</span><span style="color: #000000">dump_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_dump_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">void</span> <span style="color: #000000">restore</span><span style="color: #330033">(</span><span style="color: #000000">restore_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">,</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_restore_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #330033">}</span><span style="color: #330033">;</span>

<span style="color: #000099">// dependencies on other units</span>

<span style="color: #990000">class</span> <span style="color: #000000">lm_unit_dependency</span>
<span style="color: #330033">{</span>
<span style="color: #990000">private</span><span style="color: #330033">:</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_library</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_unit_name</span> <span style="color: #000000">m_name</span><span style="color: #330033">;</span>
<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #330033">~</span><span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_library</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_unit_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">friend</span> <span style="color: #990000">void</span> <span style="color: #000000">dump</span><span style="color: #330033">(</span><span style="color: #000000">dump_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_dump_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">void</span> <span style="color: #000000">restore</span><span style="color: #330033">(</span><span style="color: #000000">restore_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">,</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_restore_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span><span style="color: #330033">&lt;&lt;</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #330033">}</span><span style="color: #330033">;</span>

<span style="color: #000099">// the set of all dependencies</span>

<span style="color: #990000">class</span> <span style="color: #000000">lm_dependencies</span>
<span style="color: #330033">{</span>
<span style="color: #990000">private</span><span style="color: #330033">:</span>
  <span style="color: #000000">smart_ptr</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&gt;</span> <span style="color: #000000">m_source</span><span style="color: #330033">;</span>  <span style="color: #000099">// source file dependency (optional)</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&gt;</span> <span style="color: #000000">m_files</span><span style="color: #330033">;</span> <span style="color: #000099">// other file dependencies</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&gt;</span> <span style="color: #000000">m_units</span><span style="color: #330033">;</span> <span style="color: #000099">// unit dependencies</span>

<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #000000">lm_dependencies</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #330033">~</span><span style="color: #000000">lm_dependencies</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// source file dependency</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_source_file</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">source_file_present</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">source_file</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// other file dependencies</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">file_add</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">dependency</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">file_size</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">file_dependency</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">file_erase</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// unit dependencies</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">unit_add</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">dependency</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">unit_size</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_dependency</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">unit_erase</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">void</span> <span style="color: #000000">clear</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">empty</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// persistence</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">void</span> <span style="color: #000000">dump</span><span style="color: #330033">(</span><span style="color: #000000">dump_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_dump_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">void</span> <span style="color: #000000">restore</span><span style="color: #330033">(</span><span style="color: #000000">restore_context</span><span style="color: #330033">&amp;</span> <span style="color: #000000">context</span><span style="color: #330033">,</span> <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">throw</span><span style="color: #330033">(</span><span style="color: #000000">persistent_restore_failed</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// diagnostic print routines</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span> <span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #330033">}</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #000099">// library unit superclass</span>
<span style="color: #000099">// All units must be contained in an lm_library object</span>

<span style="color: #990000">class</span> <span style="color: #000000">lm_unit</span>
<span style="color: #330033">{</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">lm_library</span><span style="color: #330033">;</span>
<span style="color: #990000">private</span><span style="color: #330033">:</span>
  <span style="color: #000099">// header fields</span>
  <span style="color: #000000">lm_unit_name</span> <span style="color: #000000">m_name</span><span style="color: #330033">;</span>            <span style="color: #000099">// name</span>
  <span style="color: #000000">lm_dependencies</span> <span style="color: #000000">m_dependencies</span><span style="color: #330033">;</span> <span style="color: #000099">// file and unit dependencies</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_supplement</span><span style="color: #330033">;</span>       <span style="color: #000099">// supplementary data</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">m_header_modified</span><span style="color: #330033">;</span>         <span style="color: #000099">// header modified</span>

  <span style="color: #000099">// internal fields</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">m_loaded</span><span style="color: #330033">;</span>                  <span style="color: #000099">// loaded flag</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">m_marked</span><span style="color: #330033">;</span>                  <span style="color: #000099">// mark - determines whether the unit needs saving</span>

  <span style="color: #000099">// library manager fields</span>
  <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">m_library</span><span style="color: #330033">;</span>          <span style="color: #000099">// parent library</span>

  <span style="color: #000099">// error handling fields</span>
  <span style="color: #990000">int</span> <span style="color: #000000">m_error</span><span style="color: #330033">;</span>                    <span style="color: #000099">// error code if load or save fails</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_error_string</span><span style="color: #330033">;</span>     <span style="color: #000099">// string part of above error status</span>

<span style="color: #990000">protected</span><span style="color: #330033">:</span>
  <span style="color: #000099">// header file management</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">filename</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">header_filename</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">dump_header</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">restore_header</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #000099">////////////////////////////////////////</span>
  <span style="color: #000099">// constructor/destructor</span>

  <span style="color: #000000">lm_unit</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">,</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">virtual</span> <span style="color: #330033">~</span><span style="color: #000000">lm_unit</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////</span>
  <span style="color: #000099">// Header data</span>

  <span style="color: #000099">// unit name</span>
  <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// dependencies</span>
  <span style="color: #000099">// all file dependencies are converted for internal use to a path relative to the library</span>
  <span style="color: #000099">// they can be retrieved either in this form or as a full path</span>

  <span style="color: #000099">// source file dependency</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_source_file</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">source_file_present</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">source_file</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// other file dependencies</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">file_add</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">dependency</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">file_size</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">lm_file_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">file_dependency</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">file_erase</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// unit dependencies</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">unit_add</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">dependency</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">unsigned</span> <span style="color: #000000">unit_size</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_dependency</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_dependency</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">unit_erase</span><span style="color: #330033">(</span><span style="color: #990000">unsigned</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">const</span> <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span> <span style="color: #000000">dependencies</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_dependencies</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_dependencies</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">clear_dependencies</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">empty_dependencies</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// dependency checking</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">out_of_date</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">up_to_date</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_dependencies</span> <span style="color: #000000">out_of_date_reason</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// supplementary data</span>

  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">supplementary_data</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_supplementary_data</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////</span>
  <span style="color: #000099">// unit data management</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">loaded</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">mark</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// file modified time - only changes after a save</span>

  <span style="color: #000000">time_t</span> <span style="color: #000000">modified</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////</span>
  <span style="color: #000099">// containing library manager details</span>

  <span style="color: #000099">// get the owning library</span>
  <span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">library</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">library</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// owning library name and path</span>
  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_path</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////</span>
  <span style="color: #000099">// error handling - these apply to the last read/write operation</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">error</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">int</span> <span style="color: #000000">error_number</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">error_string</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////</span>
  <span style="color: #000099">// print diagnostics</span>
  <span style="color: #000099">// these call the print methods which may be overloaded for each subclass</span>

  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">&amp;</span> <span style="color: #000000">u</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_long</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">&amp;</span> <span style="color: #000000">u</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span> <span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">&amp;</span> <span style="color: #000000">u</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////</span>
  <span style="color: #000099">// functions that customise subclasses of this superclass</span>
  <span style="color: #000099">// You MUST provide at least:</span>
  <span style="color: #000099">//   - read - either read operation can be overloaded</span>
  <span style="color: #000099">//   - write - either write operation can be overloaded</span>
  <span style="color: #000099">//   - clone</span>

  <span style="color: #000099">// the default read(filename) calls read(itext) to actually read the file</span>
  <span style="color: #000099">// you can just overload read(itext) if you want to use TextIO, or you can overload read(filename) to use any I/O system</span>
  <span style="color: #000099">// the default read(itext) does nothing but fail by returning false so you must overload one or other</span>
  <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">read</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">filename</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">read</span><span style="color: #330033">(</span><span style="color: #000000">itext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">file</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// as above, write(filename) calls write(otext) to actually write the file</span>
  <span style="color: #000099">// you can just overload write(otext) if you want to use TextIO, or you can overload write(filename) to use any I/O system</span>
  <span style="color: #000099">// the default write(otext) does nothing but fail by returning false so you must overload one or other</span>
  <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">write</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">filename</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">write</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">file</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// purge clears any memory associated with the unit - makes the unit unloaded</span>
  <span style="color: #000099">// the default does nothing</span>
  <span style="color: #990000">virtual</span> <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// the clone function creates a copy of the subclass - see the docs on smart_ptr for an explanation</span>
  <span style="color: #990000">virtual</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">*</span> <span style="color: #000000">clone</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// the default print routines print header-only information</span>
  <span style="color: #000099">// you can overload these to provide a debug dump of the data structure</span>
  <span style="color: #990000">virtual</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">virtual</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_long</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #330033">}</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #000099">// other types used in the library manager</span>
<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>

<span style="color: #000099">// user types</span>

<span style="color: #990000">typedef</span> <span style="color: #000000">smart_ptr_nocopy</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit</span><span style="color: #330033">&gt;</span> <span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">;</span>
<span style="color: #990000">typedef</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">*</span> <span style="color: #330033">(</span><span style="color: #330033">*</span><span style="color: #000000">lm_create_callback</span><span style="color: #330033">)</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit_name</span><span style="color: #330033">,</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">parent_library</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #000099">// internal types used in the library manager but made global because they are shared</span>

<span style="color: #990000">struct</span> <span style="color: #000000">lm_callback_entry</span>
<span style="color: #330033">{</span>
  <span style="color: #000000">lm_create_callback</span> <span style="color: #000000">m_callback</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_description</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">m_type_data</span><span style="color: #330033">;</span>

  <span style="color: #000000">lm_callback_entry</span><span style="color: #330033">(</span><span style="color: #000000">lm_create_callback</span> <span style="color: #000000">callback</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">description</span> <span style="color: #330033">=</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #330033">:</span>
    <span style="color: #000000">m_callback</span><span style="color: #330033">(</span><span style="color: #000000">callback</span><span style="color: #330033">)</span><span style="color: #330033">,</span> <span style="color: #000000">m_description</span><span style="color: #330033">(</span><span style="color: #000000">description</span><span style="color: #330033">)</span><span style="color: #330033">,</span> <span style="color: #000000">m_type_data</span><span style="color: #330033">(</span><span style="color: #000000">type_data</span><span style="color: #330033">)</span> <span style="color: #330033">{</span><span style="color: #330033">}</span>
<span style="color: #330033">}</span><span style="color: #330033">;</span>

<span style="color: #990000">typedef</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">map</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">,</span><span style="color: #000000">lm_callback_entry</span><span style="color: #330033">&gt;</span> <span style="color: #000000">lm_callback_map</span><span style="color: #330033">;</span>

<span style="color: #990000">typedef</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">pair</span><span style="color: #330033">&lt;</span><span style="color: #990000">bool</span><span style="color: #330033">,</span><span style="color: #990000">unsigned</span><span style="color: #330033">&gt;</span> <span style="color: #000000">lm_tidy_result</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #000099">// Library</span>
<span style="color: #000099">// Must be contained in a library_manager</span>
<span style="color: #000099">// Manages objects of class lm_unit and its subclasses</span>
<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>

<span style="color: #990000">class</span> <span style="color: #000000">lm_library</span>
<span style="color: #330033">{</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">library_manager</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">map</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_name</span><span style="color: #330033">,</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">unit_map</span><span style="color: #330033">;</span>
<span style="color: #990000">private</span><span style="color: #330033">:</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_name</span><span style="color: #330033">;</span>                        <span style="color: #000099">// name</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_path</span><span style="color: #330033">;</span>                        <span style="color: #000099">// path</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">m_writable</span><span style="color: #330033">;</span>                           <span style="color: #000099">// writable</span>
  <span style="color: #000000">unit_map</span> <span style="color: #000000">m_units</span><span style="color: #330033">;</span>                          <span style="color: #000099">// units</span>
  <span style="color: #000000">library_manager</span><span style="color: #330033">*</span> <span style="color: #000000">m_manager</span><span style="color: #330033">;</span>                <span style="color: #000099">// parent library manager</span>

<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// library management</span>

  <span style="color: #000000">lm_library</span><span style="color: #330033">(</span><span style="color: #000000">library_manager</span><span style="color: #330033">*</span> <span style="color: #000000">manager</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #330033">~</span><span style="color: #000000">lm_library</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_library</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_library</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">=</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">const</span> <span style="color: #000000">library_manager</span><span style="color: #330033">*</span> <span style="color: #000000">manager</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">library_manager</span><span style="color: #330033">*</span> <span style="color: #000000">manager</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// initialisers</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">create</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">,</span> <span style="color: #990000">bool</span> <span style="color: #000000">writable</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">open</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// management of types</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">load_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">load_types</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">remove_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// whole library operations</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">close</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// managing read/write status</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">set_read_write</span><span style="color: #330033">(</span><span style="color: #990000">bool</span> <span style="color: #000000">writable</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">set_writable</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">set_read_only</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">writable</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">read_only</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">os_writable</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">os_read_only</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">lm_writable</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">lm_read_only</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// unit management</span>

<span style="color: #990000">private</span><span style="color: #330033">:</span>
  <span style="color: #000000">unit_map</span><span style="color: #330033">::</span><span style="color: #000000">iterator</span> <span style="color: #000000">local_find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">unit_map</span><span style="color: #330033">::</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">local_find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">exists</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">create</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">loaded</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">unit</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">mark</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">time_t</span> <span style="color: #000000">modified</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">erase_by_source</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">source_file</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_name</span><span style="color: #330033">&gt;</span> <span style="color: #000000">names</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">names</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// dependency checking</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">out_of_date</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">up_to_date</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_dependencies</span> <span style="color: #000000">out_of_date_reason</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000000">lm_tidy_result</span> <span style="color: #000000">tidy</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// I/O</span>
  <span style="color: #000099">// do-everything print routine!</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">pretty_print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span><span style="color: #330033">,</span> <span style="color: #990000">bool</span> <span style="color: #000000">print_units</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// diagnostic print routines</span>

  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_long</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">&amp;</span> <span style="color: #000000">lib</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_long</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">&amp;</span> <span style="color: #000000">lib</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span> <span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">&amp;</span> <span style="color: #000000">lib</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
<span style="color: #330033">}</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
<span style="color: #000099">// Library Manager</span>
<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>

<span style="color: #990000">class</span> <span style="color: #000000">library_manager</span>
<span style="color: #330033">{</span>
<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">lm_library</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #990000">class</span> <span style="color: #000000">lm_unit</span><span style="color: #330033">;</span>
  <span style="color: #990000">typedef</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">list</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_library</span><span style="color: #330033">&gt;</span> <span style="color: #000000">library_list</span><span style="color: #330033">;</span>

  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// static functions allow you to test whether a directory is a library before opening it</span>
  <span style="color: #000099">// you can also find the library's name without opening it</span>

  <span style="color: #990000">static</span> <span style="color: #990000">bool</span> <span style="color: #000000">is_library</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">owner</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">static</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">library_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">owner</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// non-static forms test for libraries with the same owner as the library manager</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">is_library</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">library_name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// tructors</span>

  <span style="color: #990000">explicit</span> <span style="color: #000000">library_manager</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">owner</span><span style="color: #330033">,</span> <span style="color: #990000">bool</span> <span style="color: #000000">library_case</span> <span style="color: #330033">=</span> <span style="color: #990000">false</span><span style="color: #330033">,</span> <span style="color: #990000">bool</span> <span style="color: #000000">unit_case</span> <span style="color: #330033">=</span> <span style="color: #990000">false</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #330033">~</span><span style="color: #000000">library_manager</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #990000">private</span><span style="color: #330033">:</span>
  <span style="color: #000099">// NOT a copyable object</span>
  <span style="color: #000000">library_manager</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">library_manager</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">library_manager</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">=</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">library_manager</span><span style="color: #330033">&amp;</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

<span style="color: #990000">public</span><span style="color: #330033">:</span>
  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// case sensitivity</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">library_case</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_library_case</span><span style="color: #330033">(</span><span style="color: #990000">bool</span> <span style="color: #000000">library_case</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">unit_case</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_unit_case</span><span style="color: #330033">(</span><span style="color: #990000">bool</span> <span style="color: #000000">library_case</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// type handling</span>
  <span style="color: #000099">// only units of types added in this way will be recognised</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">add_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">description</span><span style="color: #330033">,</span> <span style="color: #000000">lm_create_callback</span> <span style="color: #000000">fn</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">,</span> <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">remove_type</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">types</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">description</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_create_callback</span> <span style="color: #000000">callback</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">void</span><span style="color: #330033">*</span> <span style="color: #000000">type_data</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// Library mappings</span>
  <span style="color: #000099">// The library manager implements two different styles of library mappings</span>
  <span style="color: #000099">//   - mapping file</span>
  <span style="color: #000099">//   - ini file</span>
  <span style="color: #000099">// mapping file handling uses a simple text file to store the mappings in an internally-defined format</span>
  <span style="color: #000099">// ini file handling stores library mappings using the ini_manager component</span>
  <span style="color: #000099">// These modes are switched on by simply specifying a mapping file or an ini file to hold the mappings</span>

  <span style="color: #000099">// mapping file methods</span>

  <span style="color: #000099">// set but do not load - use this when you want to create a new mapping file</span>
  <span style="color: #990000">void</span> <span style="color: #000000">set_mapping_file</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">mapping_file</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// set and load - use this with an existing mapping file</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">load_mappings</span> <span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">mapping_file</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// return the mapping file string</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">mapping_file</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// ini file methods - the ini manager must be pre-loaded with the list of ini files to manage</span>

  <span style="color: #000099">// set and load - this will create the relevant sections in the local ini file if not present already</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">set_ini_manager</span><span style="color: #330033">(</span><span style="color: #000000">ini_manager</span><span style="color: #330033">*</span> <span style="color: #000000">ini_files</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library_section</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">work_section</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">ini_manager</span><span style="color: #330033">*</span> <span style="color: #000000">get_ini_manager</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// save to the library mapping handler, whichever kind it is</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">save_mappings</span> <span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// library management</span>

  <span style="color: #000099">// operations on a single library</span>
  <span style="color: #000099">// test whether a named library exists</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">exists</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000099">// create a new libarry in the specified directory</span>
  <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">create</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">,</span> <span style="color: #990000">bool</span> <span style="color: #000000">writable</span> <span style="color: #330033">=</span> <span style="color: #990000">true</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// open an existing library</span>
  <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">open</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">path</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// load all units in the library</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// save all marked units in the library</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// purge all loaded units in the library</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// close the library - remove it from the manager but leave on disk</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">close</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000099">// erase the library - delete the directory and remove the library from the manager</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// operations on all libraries - as above but applied to all the libraries in the manager</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">close</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">// get name and path of a library - name can differ in case if the library manager is case-insensitive</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">name</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">path</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// control and test read/write status</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">set_writable</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">set_read_only</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">writable</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">read_only</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">os_writable</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">os_read_only</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">lm_writable</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">lm_read_only</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// find a library in the manager - returns null if not found</span>
  <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// get the set of all library names</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">names</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000099">// get the set of all libraries</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_library</span><span style="color: #330033">*</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// current library management</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">setwork</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">unsetwork</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">const</span> <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">work</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_library</span><span style="color: #330033">*</span> <span style="color: #000000">work</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">work_name</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// unit management within a library</span>
  <span style="color: #000099">// Note: you can also manipulate the library class through a handle returned by find() or handles()</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">exists</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">create</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">loaded</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">load</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">purge</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">save</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">erase</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">mark</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">time_t</span> <span style="color: #000000">modified</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">erase_by_source</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">source_file</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_unit_ptr</span> <span style="color: #000000">find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_name</span><span style="color: #330033">&gt;</span> <span style="color: #000000">names</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&gt;</span> <span style="color: #000000">names</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">vector</span><span style="color: #330033">&lt;</span><span style="color: #000000">lm_unit_ptr</span><span style="color: #330033">&gt;</span> <span style="color: #000000">handles</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// dependency checking</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">out_of_date</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">up_to_date</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_dependencies</span> <span style="color: #000000">out_of_date_reason</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">lm_unit_name</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>

  <span style="color: #000099">// delete out of date units from a library or all libraries</span>
  <span style="color: #000099">// return the number of units tidied and a flag to say whether all units were successfully tidied</span>
  <span style="color: #000000">lm_tidy_result</span> <span style="color: #000000">tidy</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">lm_tidy_result</span> <span style="color: #000000">tidy</span><span style="color: #330033">(</span><span style="color: #990000">void</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// do-everything print routine!</span>

  <span style="color: #990000">bool</span> <span style="color: #000000">pretty_print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span>
                    <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">,</span>                            <span style="color: #000099">// indent the printout by this many indentation points</span>
                    <span style="color: #990000">bool</span> <span style="color: #000000">print_units</span> <span style="color: #330033">=</span> <span style="color: #990000">false</span><span style="color: #330033">,</span>                       <span style="color: #000099">// print the unit names as well as the library names</span>
                    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">library</span> <span style="color: #330033">=</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">,</span>     <span style="color: #000099">// print just the specified library ("" means all)</span>
                    <span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">type</span> <span style="color: #330033">=</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">(</span><span style="color: #330033">)</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span> <span style="color: #000099">// print just this type ("" means all)</span>

  <span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// diagnostic print routines</span>

  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_long</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">library_manager</span><span style="color: #330033">&amp;</span> <span style="color: #000000">manager</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">print_long</span><span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">library_manager</span><span style="color: #330033">&amp;</span> <span style="color: #000000">manager</span><span style="color: #330033">,</span> <span style="color: #990000">unsigned</span> <span style="color: #000000">indent</span> <span style="color: #330033">=</span> <span style="color: #993399">0</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #990000">friend</span> <span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #990000">operator</span> <span style="color: #330033">&lt;&lt;</span> <span style="color: #330033">(</span><span style="color: #000000">otext</span><span style="color: #330033">&amp;</span> <span style="color: #000000">str</span><span style="color: #330033">,</span> <span style="color: #990000">const</span> <span style="color: #000000">library_manager</span><span style="color: #330033">&amp;</span> <span style="color: #000000">libraries</span><span style="color: #330033">)</span><span style="color: #330033">;</span>

  <span style="color: #000099">//////////////////////////////////////////////////////////////////////////////</span>
  <span style="color: #000099">// internals</span>
<span style="color: #990000">protected</span><span style="color: #330033">:</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_owner</span><span style="color: #330033">;</span>                               <span style="color: #000099">// owner application name</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_mapping_file</span><span style="color: #330033">;</span>                        <span style="color: #000099">// mapping file method of library management</span>
  <span style="color: #000000">ini_manager</span><span style="color: #330033">*</span> <span style="color: #000000">m_ini_files</span><span style="color: #330033">;</span>                          <span style="color: #000099">// ini manager method of library management</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_ini_section</span><span style="color: #330033">;</span>                         <span style="color: #000099">// ini manager method of library management</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_ini_work</span><span style="color: #330033">;</span>                            <span style="color: #000099">// ini manager method of library management</span>
  <span style="color: #000000">library_list</span> <span style="color: #000000">m_libraries</span><span style="color: #330033">;</span>                          <span style="color: #000099">// libraries</span>
  <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span> <span style="color: #000000">m_work</span><span style="color: #330033">;</span>                                <span style="color: #000099">// work library</span>
  <span style="color: #000000">lm_callback_map</span> <span style="color: #000000">m_callbacks</span><span style="color: #330033">;</span>                       <span style="color: #000099">// callbacks</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">m_library_case</span><span style="color: #330033">;</span>                               <span style="color: #000099">// case sensitivity for library names</span>
  <span style="color: #990000">bool</span> <span style="color: #000000">m_unit_case</span><span style="color: #330033">;</span>                                  <span style="color: #000099">// case sensitivity for unit names</span>

  <span style="color: #000000">library_list</span><span style="color: #330033">::</span><span style="color: #000000">iterator</span> <span style="color: #000000">local_find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span><span style="color: #330033">;</span>
  <span style="color: #000000">library_list</span><span style="color: #330033">::</span><span style="color: #000000">const_iterator</span> <span style="color: #000000">local_find</span><span style="color: #330033">(</span><span style="color: #990000">const</span> <span style="color: #000000">std</span><span style="color: #330033">::</span><span style="color: #000000">string</span><span style="color: #330033">&amp;</span> <span style="color: #000000">name</span><span style="color: #330033">)</span> <span style="color: #990000">const</span><span style="color: #330033">;</span>
<span style="color: #330033">}</span><span style="color: #330033">;</span>

<span style="color: #000099">////////////////////////////////////////////////////////////////////////////////</span>

<span style="color: #990000">#endif</span>
</pre>
</body>
</html>
